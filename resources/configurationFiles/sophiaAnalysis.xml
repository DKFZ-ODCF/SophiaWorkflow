<configuration name='sophiaAnalysis' description=''
               configurationType='analysis' class='de.dkfz.roddy.core.Analysis'
               workflowClass='de.dkfz.b080.co.sophiaworkflow.SophiaWorkflow'
               runtimeServiceClass='de.dkfz.b080.co.common.BasicCOProjectsRuntimeService'
               listOfUsedTools=""
               usedToolFolders="sophiaworkflow,tools"
               cleanupScript="cleanupScript">
    <configurationvalues>
        <!-- ## Imported from cofilenames -->
        <cvalue name='sampleDirectory' value='${inputBaseDirectory}/${pid}/${sample}/${library}/${SEQUENCER_PROTOCOL}' type='path'/>
        <cvalue name='sequenceDirectory' value='${sampleDirectory}/${run}/sequence' type='path'/>
        <cvalue name='mergedBamSuffix_markDuplicatesShort' value='merged.mdup.bam' type="string"/>
        <cvalue name='mergedBamSuffixList' value='${mergedBamSuffix_markDuplicatesShort}' type="string" description="A list of all known suffixes for merged bam files. I.e. merged.dupmark.bam, merged.mdup.bam..."/>
        <cvalue name='defaultMergedBamSuffix' value='${mergedBamSuffix_markDuplicatesShort}' type="string" description="The default suffix for merged bam files when they are created by Roddy."/>

        <!-- ## Imported from cobase project -->
        <cvalue name='possibleControlSampleNamePrefixes' value='( blood BLOOD normal control CONTROL buffy_coat GERMLINE )' type='bashArray'/>
        <cvalue name='possibleTumorSampleNamePrefixes' value='( tumor TUMOR metastasis xenograft disease DISEASE relapse RELAPSE autopsy AUTOPSY metastasis METASTASIS )' type='bashArray'/>
        <cvalue name='possibleSingleCellSampleNamePrefixes' value='( SingleCell single_cell )' type='bashArray'/>
        <cvalue name="useCentralAnalysisArchive" value="true"/>
        <cvalue name="enableJobProfiling" value="false"/>
        <cvalue name='QUAL' value='phred' description="Default quality is phred, can be illumina."/>

        <!-- ## Imported from commonCOWorkflowsSettings -->
        <cvalue name='SEQUENCER_PROTOCOL' value='paired' type="string" description="only paired read sequencing is currently supported"/>

        <!-- ## DIRECTORIES -->
        <cvalue name='alignmentOutputDirectory' value='alignment' type='string'/>
        <cvalue name='insertSizesOutputDirectory' value='insertsize_distribution'/>
        <cvalue name='qcOutputDirectory' value='qualitycontrol' type='string'/>
        <cvalue name='sophiaOutputDirectory' value='SOPHIA_${tumorSample}_${controlSample}' type='string'/>
        <cvalue name='ALIGNMENT_DIR' value='${outputAnalysisBaseDirectory}/${alignmentOutputDirectory}' type='string'/>
        <cvalue name='SOPHIA_DIR' value='${outputAnalysisBaseDirectory}/${sophiaOutputDirectory}' type='string'/>

        <!-- Software modules - if enabled these will over ride the binary definitions -->
        <cvalue name="workflowEnvironmentScript" value="workflowEnvironment_tbiPbs" type="string"/>
        <cvalue name='LOAD_MODULE' value='true' type='boolean' description="Only relevant for workflowEnvironmentScript=workflowEnvironment_tbiPbs"/>
        <cvalue name='MODULE_ENV' value='HIPO2_sv/v1' type='string'/>

        <!-- These variables are needed for the annotations files below.
             Additionally, on the TBI PBS cluster they are used to compose the path to the Sophia binary. -->
        <cvalue name="SOPHIA_VERSION" value="34.0" type="string"/>
        <cvalue name='PIPELINE_BASE' value='/tbi/cluster/13.1/x86_64/sophia/sophia-${SOPHIA_VERSION}' type='string' />
        <cvalue name="ANNOTATION_PIPELINE_BASE" value="${PIPELINE_BASE}/sophiaAnnotate"
                description="Set this to the sophiaAnnotate directory in the Sophia installation that you use."/>

        <!-- ## Default file acces -->
        <cvalue name='outputFileGroup' value='B080'/>
        <cvalue name='outputUMask' value='007' type='string'/>
        <cvalue name='outputAccessRights' value='u+rw,g+rw,o-rwx'/>
        <cvalue name='outputAccessRightsForDirectories' value='u+rwx,g+rwx,o-rwx'/>
        <cvalue name='outputAllowAccessRightsModification' value='false' type="boolean"/>

        <!-- Sophia specific values -->

        <!-- ANNOTATION HEADER -->
        <!-- <cvalue name="STANDARDHEADER" value='"#chrom1\tstart1\tend1\tchrom2\tstart2\tend2\tsomaticity1\tsomaticity2\tsvtype\teventScore\teventSize\teventInversion\tevidence1\tclonalityRatio1\tevidence2\tclonalityRatio2\tsource1\tsource2\tgene1\tnearestCodingGeneUpstream1\tnearestCodingGeneUpstreamDistance1\tnearestCodingGeneDownstream1\tnearestCodingGeneownstreamDistance1\tgene2\tnearestCodingGeneUpstream2\tnearestCodingGeneUpstreamDistance2\tnearestCodingGeneDownstream2\tnearestCodingGeneownstreamDistance2"' description=""/>-->
        <cvalue name="STANDARDHEADER" value='"#chrom1\tstart1\tend1\tchrom2\tstart2\tend2\tsomaticity1\tsomaticity2\tsvtype\teventScore\teventSize\teventInversion\tevidence1\tclonalityRatio1\tevidence2\tclonalityRatio2\tsource1\tsource2\tgene1\tcancerGene1\tnearestCodingGeneUpstream1\tnearestCodingGeneUpstreamDistance1\tnearestCancerGeneUpstream1\tnearestCancerGeneUpstreamDistance1\tnearestCodingGeneDownstream1\tnearestCodingGeneDownstreamDistance1\tnearestCancerGeneDownstream1\tnearestCancerGeneDownstreamDistance1\tgene2\tcancerGene2\tnearestCodingGeneUpstream2\tnearestCodingGeneUpstreamDistance2\tnearestCancerGeneUpstream2\tnearestCancerGeneUpstreamDistance2\tnearestCodingGeneDownstream2\tnearestCodingGeneDownstreamDistance2\tnearestCancerGeneDownstream2\tnearestCancerGeneDownstreamDistance2\tdbSUPERenhancer1\tdbSUPERenhancer2\trescuedEnhancerHitCandidate\tTADindices\taffectedCodingGenesTADestimate\taffectedCancerGenesTADestimate"' description=""/>

        <!-- DATABASES AND REFERENCE FILES -->
        <cvalue name='REFERENCES_BASE' value='${ANNOTATION_PIPELINE_BASE}/annotationMaterials/' type='string' />
        <cvalue name='mergedRef' value='${PIPELINE_BASE}/hg19_WholeGenome_merged_NOMT.bed' type='string' />
        <cvalue name='geneRefBedCancer' value='${REFERENCES_BASE}/gencode.v19.annotation_plain.genes_collapsed_sorted_CANCER.bed.gz' type='string' />
        <cvalue name='exonsOnlyPaddedRefBed' value='${REFERENCES_BASE}/gencode.v19.annotation_plain.exonsOnly.sorted_uniq_collapsed_sorted.padded_3.bed.gz' type='string' />
        <cvalue name='spliceJunctionsRefBed' value='${REFERENCES_BASE}/mergedIntrons.bed.gz' type='string' />
        <cvalue name='combinedSuperEnhancerRefBed' value='${REFERENCES_BASE}/dbSUPERenhancers_hg19_060417.bed.gz' type='string' />
        <cvalue name='roadmapEnhancerRefBed' value='${REFERENCES_BASE}/ROADMAP_EnhA_EnhBiv_EnhG.min5_Sorted.bed.gz' type='string' />
        <cvalue name='consensusTadReferenceBed' value='${REFERENCES_BASE}/consensusTADs_3_sorted_annotated.bed' type='string' />
        <cvalue name='geneRefBed' value='${REFERENCES_BASE}/gencode.v19.annotation_plain.genes_collapsed_sorted.bed.gz' type='string' />
        <cvalue name='geneRefBedCoding' value='${REFERENCES_BASE}/gencode.v19.annotation_plain.genes_collapsed_sorted_filtered_coding.bed.gz' type='string' />
        <cvalue name='intronExonRefBed' value='${REFERENCES_BASE}/gencode.v19.annotation_plain.exons_introns.sorted_uniq_collapsed_sorted_filtered.bed.gz' type='string' />
        <cvalue name='repeatsRefBed' value='${REFERENCES_BASE}/repeatmasker_hg19_nostrand_nolength_sorted.bed.gz' type='string' />
        <cvalue name='chromSizesRef' value='${REFERENCES_BASE}/hg19_chromSizes_withContigsDecoys.genome' type='string' />
        <cvalue name='pidsInMref' value='3261' type='string' />
        <cvalue name='mRef' value='${REFERENCES_BASE}/mergedMref_v${SOPHIA_VERSION}_${pidsInMref}_mergedBpCounts.bed.gz' type='string' />

        <!-- PARAMTER VALUES -->
        <cvalue name='mapqThreshold' value='13' type='integer' />
        <cvalue name='clipThreshold' value='10' type='integer' />
        <cvalue name='qualThreshold' value='23' type='integer' />
        <cvalue name='qualThresholdLow' value='12' type='integer' />
        <cvalue name='lowQualOverhangThreshold' value='5' type='integer' />
        <cvalue name='isizeSigmaThreshold' value='5' type='integer' />
        <cvalue name='bpSupportThreshold' value='3' type='integer' />
        <cvalue name='tumorDefaultReadLength' value='151' type='integer' description="#151 for x10, 101 for older hiseq data" />
        <cvalue name='controlDefaultReadLength' value='151' type='integer' description="#151 for x10, 101 for older hiseq data" />
        <cvalue name='smallEventThreshold' value='5000' type='string' />
        <cvalue name='artifactLoFreq' value='33' type='integer' />
        <cvalue name='artifactHiFreq' value='66' type='integer' />
        <cvalue name='clonalityLoFreq' value='5' type='integer' />
        <cvalue name='clonalityStrictLoFreq' value='20' type='integer' />
        <cvalue name='clonalityHiFreq' value='85' type='integer' />
        <cvalue name='bpFreq' value='5' type='integer' />
        <cvalue name='germlineFuzziness' value='2' type='integer' />
        <cvalue name='germlineDbLimit' value='10' type='integer' />

    </configurationvalues>
    <processingTools>
        <tool name="workflowEnvironment_tbiPbs" value="tbi-pbs.sh" basepath="sophiaworkflow/environments"/>
        <tool name="workflowEnvironment_tbiLsf" value="tbi-lsf.sh" basepath="sophiaworkflow/environments"/>

        <!-- START NEW -->
        <tool name='fusionCandidatesScript' value='fusionCandidates.py' basepath="sophiaworkflow" />
        <tool name='coordinateCorrectionScript' value='sophiaAnnotateCoordinateCorrection.py' basepath="sophiaworkflow" />
        <tool name='rnacontDelExtractorScript' value='delExtractorForRNAcontamination.py' basepath="sophiaworkflow" />
        <tool name='rnacontDelCounterScript' value='counterForRNAcontamination.py' basepath="sophiaworkflow" />
        <tool name='rnadecontStep1Script' value='RNAdecontaminationStep1.py' basepath="sophiaworkflow" />
        <tool name='rnadecontStep2Script' value='RNAdecontaminationStep2.py' basepath="sophiaworkflow" />
        <tool name='directhitcollapseScript' value='intersectionCollapsing.py' basepath="sophiaworkflow" />
        <tool name='intrachromosomaleventpicker' value='getIntrachromosomalRanges.py' basepath="sophiaworkflow" />
        <tool name='tadannotationScript' value='tadIntersections.py' basepath="sophiaworkflow" />
        <!-- END NEW -->

        <tool name="circlizeScript" value="circlizeEvents.R" basepath="sophiaworkflow"/>
        <tool name="sophiaAnnotateCoordinateCorrection" value="sophiaAnnotateCoordinateCorrection.py" basepath="sophiaworkflow"/>

        <tool name="sophia" value="sophiaCalling.sh" basepath="sophiaworkflow">
            <resourcesets>
                <rset size="s" memory="1g" cores="2" nodes="1" walltime="3h" queue="devel"/>
                <rset size="l" memory="1g" cores="2" nodes="1" walltime="120h"/>
            </resourcesets>
            <input type="file" typeof="BasicBamFile" scriptparameter="BAMFILE"/>
            <input type="file" typeof="InsertSizesValueFile" scriptparameter="mergedIsizes"/>
            <input type="string" setby="callingCode" scriptparameter="defaultReadLength"/>
            <output type="file" typeof="SophiaOutputBedpe" scriptparameter="BPS_OUT"/>
        </tool>

        <tool name="sophiaAnnotatorNoControl" value="sophiaAnnotateAbridgedCaller.sh" basepath="sophiaworkflow">
            <resourcesets>
                <rset size="s" memory="1g" cores="1" nodes="1" walltime="1h" queue="devel"/>
                <rset size="l" memory="4g" cores="1" nodes="1" walltime="8h"/>
            </resourcesets>
            <input type="file" typeof="SophiaOutputBedpe" scriptparameter="tumorFile"/>
            <output type="tuple">
                <output type="file" typeof="AnnotationFilteredGermlineBedpeFileNoControl" scriptparameter="BEDPE_RESULT_FILE_FILTERED_GERMLINE"/>
                <output type="file" typeof="AnnotationFilteredBedpeFileNoControl" scriptparameter="BEDPE_RESULT_FILE_FILTERED"/>
                <output type="file" typeof="AnnotationFilteredSomaticBedpeFileNoControl" scriptparameter="BEDPE_RESULT_FILE_FILTERED_SOMATIC"/>
                <output type="file" typeof="AnnotationFilteredSomaticBedpeFileNoControlACEseq" scriptparameter="BEDPE_RESULT_FILE_FILTERED_SOMATIC_ACESEQ"/>
                <output type="file" typeof="AnnotationFilteredQJsonNoControl" scriptparameter="QC_JSON_FILE"/>
            </output>
        </tool>

        <tool name="sophiaAnnotator" value="sophiaAnnotateAbridgedCaller.sh" basepath="sophiaworkflow">
            <resourcesets>
                <rset size="s" memory="1g" cores="1" nodes="1" walltime="1h" queue="devel"/>
                <rset size="l" memory="4g" cores="1" nodes="1" walltime="8h"/>
            </resourcesets>
            <input type="file" typeof="SophiaOutputBedpe" scriptparameter="bloodFile"/>
            <input type="file" typeof="SophiaOutputBedpe" scriptparameter="tumorFile"/>
            <output type="tuple">
                <output type="file" typeof="AnnotationFilteredGermlineBedpeFileTmVsCntrl" scriptparameter="BEDPE_RESULT_FILE_FILTERED_GERMLINE"/>
                <output type="file" typeof="AnnotationFilteredBedpeFileTmVsCntrl" scriptparameter="BEDPE_RESULT_FILE_FILTERED"/>
                <output type="file" typeof="AnnotationFilteredSomaticBedpeFileTmVsCntrl" scriptparameter="BEDPE_RESULT_FILE_FILTERED_SOMATIC"/>
                <output type="file" typeof="AnnotationFilteredSomaticBedpeFileTmVsCntrlACEseq" scriptparameter="BEDPE_RESULT_FILE_FILTERED_SOMATIC_ACESEQ"/>
                <output type="file" typeof="AnnotationFilteredQJsonTmVsCntrl" scriptparameter="QC_JSON_FILE"/>
            </output>
        </tool>
    </processingTools>
    <filenames package='de.dkfz.b080.co.files' filestagesbase='de.dkfz.b080.co.files.COFileStage'>
  <!--  <filename class='InsertSizesValueFile' derivedFrom='BasicBamFile' pattern='${outputAnalysisBaseDirectory}/${insertSizesOutputDirectory}/${sourcefileAtomicPrefix,delimiter="_"}_insertsize_plot.png_qcValues.txt'/> -->
        <filename class='InsertSizesValueFile' derivedFrom='BasicBamFile'
                  pattern='${outputAnalysisBaseDirectory}/qualitycontrol/${sample}/merged/${insertSizesOutputDirectory}/${sourcefileAtomicPrefix,delimiter="_"}_insertsize_plot.png_qcValues.txt'/>

        <filename class='SophiaOutputBedpe' derivedFrom="BasicBamFile"
                  pattern='${outputAnalysisBaseDirectory}/${sophiaOutputDirectory}/${sample}_${pid}_bps.tsv.gz'/>

        <filename class='AnnotationFilteredGermlineBedpeFileNoControl'   derivedFrom='SophiaOutputBedpe'
                  pattern='${outputAnalysisBaseDirectory}/${sophiaOutputDirectory}/svs_${pid}_${tumorSample}-only_filtered_germlineStrict.tsv'/>
        <filename class='AnnotationFilteredBedpeFileNoControl'           derivedFrom='SophiaOutputBedpe'
                  pattern='${outputAnalysisBaseDirectory}/${sophiaOutputDirectory}/svs_${pid}_${tumorSample}-only_filtered.tsv'/>
        <filename class='AnnotationFilteredSomaticBedpeFileNoControl'    derivedFrom='SophiaOutputBedpe'
                  pattern='${outputAnalysisBaseDirectory}/${sophiaOutputDirectory}/svs_${pid}_${tumorSample}-only_filtered_somatic.tsv'/>
        <filename class='AnnotationFilteredSomaticBedpeFileNoControlACEseq'    derivedFrom='SophiaOutputBedpe'
                  pattern='${outputAnalysisBaseDirectory}/${sophiaOutputDirectory}/svs_${pid}_filtered_somatic_minEventScore3.tsv'/>
        <filename class='AnnotationFilteredQJsonNoControl'               derivedFrom='SophiaOutputBedpe'
                  pattern='${outputAnalysisBaseDirectory}/${sophiaOutputDirectory}/svs_${pid}_${tumorSample}-only.qualitycontrol.json'/>


        <filename class='AnnotationFilteredGermlineBedpeFileTmVsCntrl'   derivedFrom='SophiaOutputBedpe'
                  pattern='${outputAnalysisBaseDirectory}/${sophiaOutputDirectory}/svs_${pid}_${tumorSample}-${controlSample}_filtered_germlineStrict.tsv'/>
        <filename class='AnnotationFilteredBedpeFileTmVsCntrl'           derivedFrom='SophiaOutputBedpe'
                  pattern='${outputAnalysisBaseDirectory}/${sophiaOutputDirectory}/svs_${pid}_${tumorSample}-${controlSample}_filtered.tsv'/>
        <filename class='AnnotationFilteredSomaticBedpeFileTmVsCntrl'    derivedFrom='SophiaOutputBedpe'
                  pattern='${outputAnalysisBaseDirectory}/${sophiaOutputDirectory}/svs_${pid}_${tumorSample}-${controlSample}_filtered_somatic.tsv'/>
        <filename class='AnnotationFilteredSomaticBedpeFileTmVsCntrlACEseq'    derivedFrom='SophiaOutputBedpe'
                  pattern='${outputAnalysisBaseDirectory}/${sophiaOutputDirectory}/svs_${pid}_filtered_somatic_minEventScore3.tsv'/>
        <filename class='AnnotationFilteredQJsonTmVsCntrl'                     derivedFrom='SophiaOutputBedpe'
                  pattern='${outputAnalysisBaseDirectory}/${sophiaOutputDirectory}/svs_${pid}_${tumorSample}-${controlSample}.qualitycontrol.json'/>

    </filenames>
</configuration>
